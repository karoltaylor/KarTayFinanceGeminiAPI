# AWS SAM Quick Reference

Quick reference for common AWS SAM CLI commands.

## Build & Deploy

```bash
# Build the application
sam build

# Deploy (first time - guided)
sam deploy --guided

# Deploy (subsequent times)
sam deploy

# Deploy to specific environment
sam deploy --config-env production
sam deploy --config-env staging
sam deploy --config-env development

# Deploy with parameters
sam deploy --parameter-overrides \
  MongoDBUrl="mongodb+srv://user:pass@cluster.mongodb.net/" \
  GoogleApiKey="your-key"
```

## Local Testing

```bash
# Start local API Gateway
sam local start-api

# Start with environment variables
sam local start-api --env-vars env.json

# Invoke function directly
sam local invoke FinanceAPIFunction

# Invoke with event
sam local invoke FinanceAPIFunction --event events/test.json
```

## Monitoring & Logs

```bash
# Tail logs in real-time
sam logs --name FinanceAPIFunction --stack-name kartay-finance-api --tail

# View recent logs
sam logs --name FinanceAPIFunction --stack-name kartay-finance-api --start-time '10min ago'

# View logs for specific time
sam logs --name FinanceAPIFunction --stack-name kartay-finance-api \
  --start-time '2024-10-09T10:00:00' --end-time '2024-10-09T11:00:00'
```

## Validation & Debugging

```bash
# Validate template
sam validate

# Validate with lint
sam validate --lint

# Build with debug
sam build --debug

# Deploy with debug
sam deploy --debug
```

## Development Workflow

```bash
# Watch for changes and auto-sync (fast development)
sam sync --watch

# Sync only code changes
sam sync --code

# Sync without confirmation
sam sync --watch --no-dependency-layer
```

## Stack Management

```bash
# List stacks
aws cloudformation list-stacks

# Describe stack
aws cloudformation describe-stacks --stack-name kartay-finance-api

# Delete stack
sam delete --stack-name kartay-finance-api

# Delete without confirmation
sam delete --stack-name kartay-finance-api --no-prompts
```

## Package & Export

```bash
# Package for deployment
sam package --output-template-file packaged.yaml --s3-bucket your-bucket

# Export OpenAPI spec
sam local start-api --port 3000
# Then visit: http://localhost:3000/openapi.json
```

## Configuration

```bash
# Use specific config
sam deploy --config-file custom-samconfig.toml

# Use specific config environment
sam deploy --config-env production

# Override all parameters
sam deploy --parameter-overrides \
  MongoDBUrl="value1" \
  GoogleApiKey="value2" \
  Environment="production"
```

## Tips

1. **First deployment**: Always use `sam deploy --guided` to generate samconfig.toml
2. **Fast iteration**: Use `sam sync --watch` during development
3. **Debug issues**: Check CloudWatch logs with `sam logs --tail`
4. **Validate changes**: Run `sam validate` before deploying
5. **Save costs**: Delete unused stacks with `sam delete`

## Environment Variables for Local Testing

Create `env.json`:
```json
{
  "FinanceAPIFunction": {
    "MONGODB_URL": "mongodb+srv://user:pass@cluster.mongodb.net/",
    "MONGODB_DATABASE": "financial_tracker",
    "GOOGLE_API_KEY": "your-google-api-key",
    "GENAI_MODEL": "models/gemini-2.5-flash",
    "ALLOWED_HOSTS": "*",
    "ENFORCE_HTTPS": "false"
  }
}
```

Then use: `sam local start-api --env-vars env.json`

## API Gateway URLs

After deployment, your API will be available at:
```
Base URL: https://{api-id}.execute-api.{region}.amazonaws.com/{stage}/
Docs: https://{api-id}.execute-api.{region}.amazonaws.com/{stage}/docs
ReDoc: https://{api-id}.execute-api.{region}.amazonaws.com/{stage}/redoc
```

