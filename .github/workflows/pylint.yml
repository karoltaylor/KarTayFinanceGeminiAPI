name: PyLint

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  pylint:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.11", "3.12", "3.13"]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
        cache: 'pip'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pylint
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    - name: Create .pylintrc config
      run: |
        cat > .pylintrc << EOF
        [MASTER]
        # Ignore test files and migrations
        ignore=tests,migrations,venv,.venv,env
        
        [MESSAGES CONTROL]
        # Disable specific warnings
        disable=
            C0111,  # missing-docstring
            C0103,  # invalid-name
            R0903,  # too-few-public-methods
            R0913,  # too-many-arguments
            W0212,  # protected-access (for _internal methods)
            C0415,  # import-outside-toplevel
            W0613,  # unused-argument
            R0801,  # duplicate-code
        
        [FORMAT]
        max-line-length=120
        
        [DESIGN]
        max-attributes=10
        max-locals=20
        
        [BASIC]
        good-names=i,j,k,ex,Run,_,db,id,v
        EOF

    - name: Lint API with PyLint
      run: |
        pylint api/ --exit-zero --output-format=colorized

    - name: Lint src with PyLint
      run: |
        pylint src/ --exit-zero --output-format=colorized

    - name: Generate PyLint report
      run: |
        pylint api/ src/ --exit-zero --output-format=json > pylint-report.json || true
        
    - name: Upload PyLint report
      uses: actions/upload-artifact@v4
      with:
        name: pylint-report-${{ matrix.python-version }}
        path: pylint-report.json
        retention-days: 30

    - name: Lint with stricter rules (for informational purposes)
      run: |
        echo "=== PyLint Score ==="
        pylint api/ src/ --exit-zero || true

